<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="description" content="FAForever Game Patchnotes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Patch 3751</title>
    <link rel="stylesheet" href="/style/game.css">
  </head>
  <body>
    <main class="grid">
      <div class="content">
        <div id="intro">
            <h1>Game Patch 3751</h1>

            <p>In this first development update of 2023, we introduce three month's work of bugfixes, quality of life changes, and assorted improvements. It is, by far, the most exciting patch we've released so far. While the full changes are detailed below, a quick summary of those changes we think you'll find most important:
              <ul>
                <li>We've changed how structures interact with the terrain. Previously, structures built on uneven ground could create terrain deformations. On some maps, this resulted in changes to the terrain that prevented the player from placing neighboring structures and created pathing issues for units. With this update, buildings deform the terrain less and may be placed at a slight angle.</li>
                <li>We've introduced a new series of hotkeys that will make it easier to select and micromanage your units.</li>
                <li>The process of managing your mex upgrades will now be easier than ever thanks to several small features. You can now choose to have mexes automatically queue an upgrade and (un)pause extractors when you order engineers to assist them.</li>
                <li>Several smaller quality of life changes have been made to existing features, such as no more empty reclaim orders and preventing ground attack orders from snapping to props or units. You can read more about all these changes in the 'Features' section.</li>
              </ul>
            </p>

            <p>In future updates, we'll be shifting our focus to improving the AI we ship with FAF. So far, we've been working on a navigational mesh that can help the AI understand any map you throw at it. The task ahead is to extend this with additional features to help the AI understand specifics about a map. You can read what we've achieved this patch in the 'AI' and 'Navigational mesh' sections.</p>

            <p>And last, but certainly not least: this patch contains the largest performance improvement to date; the game is on average 10% to 20% faster in comparison to the last developers patch! This is exciting because with this patch the average game no longer slows down. We've been running tests and a CPU as cheap as a Ryzen 3600 can now run up to 6000 units without slowing down. We find this is extremely exciting: the game is nearing the point where you can just enjoy playing the originally intended experience in real-time!</p>

            <p>With appreciation towards all the contributors that made this patch possible,</p>

            <p>-- Jip</p>
            <hr>
        </div>

        <h2 id="features">Features</h2>

        <div id="all-features">

          <div class="card">
            <h3>Improve terrain structure interactions</h3>
            <p>Instead of flattening the ground below structures, they now slightly tilt to reduce terrain deformation.</p>
          </div>

          <div class="card">
            <h3>Ground attack now ignores all props/units</h3>
            <p>You can now assign a ground attack exactly where you clicked without it accidentally snapping to props or units</p>
          </div>

          <div class="card">
            <h3>Prevent being able to issue 'empty' reclaim orders</h3>
            <p>It is now impossible to create a reclaim order with no prop or unit attached to it</p>
          </div>

          <div class="card">
            <h3>Move command mode no longer creates patrol orders by accident</h3>
            <p>When you specifically issue move commands using the hotkey (usually 'm') or by clicking on the move command button it now ignores the 'convert to patrol' functionality</p>
          </div>

          <div class="card">
            <h3>Remove the use of CTRL to issue commands with formations</h3>
            <p>When you hold control units first move towards each other and create a formation before they would go to where you told them to. This is a hidden feature of the engine and often players were not aware. We patched this out because often people use the same key for hotkeys, after which players (usually accidentally) would issue a formation order instead of a regular move or attack move order</p>
          </div>

          <div class="card">
            <h3>Add game option to tweak the camera shake multiplier</h3>
            <p>When set to zero it will entirely remove shaking from the game. Additionally, the default shake multiplier is now set to 0.5 (instead of 1.0)</p>
          </div>

          <div class="card">
            <h3>Add game option to upgrade and pause tech 1 extractors when you issue an assist order</h3>
            <p>A small quality of life feature that reduces the use of a few hotkeys</p>
          </div>

          <div class="card">
            <h3>Add game option to unpause tech 1 extractors as engineers start assisting</h3>
            <p>A small quality of life feature that reduces the need to check up on your extractors</p>
          </div>

          <div class="card">
            <h3>Add hotkeys to divide your current selection into subgroups</h3>
            <p>There is a separate hotkey to tab through the subgroups. This feature significantly improves your ability to manage and micro larger chunks of units</p>

            <b>As a few examples of divisions:</b>
            <ul>
              <li>Divide your selection by tech level</li>
              <li>Divide your selection into groups of 5</li>
              <li>Divide your selection over those nearest and furthest from your mouse location</li>
              <li>Divide your selection into two equally sized groups</li>
            </ul>

            <p>For UI mod authors: the changes introduces a framework that allows you to define additional ways to split a selection into subgroups.</p>
          </div>

          <div class="card">
            <h3>Add mission briefings to the lobby for all campaigns that ship with Supreme Commander</h3>
            <p>When you are in a co-op lobby the patch notes button is replaced with a briefings button. There you can see the briefing of a map. Only original campaign maps support this feature at the moment.</p>
          </div>

          <div class="card">
            <h3>Add hotkey that resembles the 'hard move' functionality introduced by Strogo</h3>
            <p>For those unware: it allows you to continiously issue move orders without queueing them and without accidentally converting them to patrol orders. This is particularly useful for ASF battles</p>
          </div>

          <div class="card">
            <h3>Adds a partial share game option</h3>
            <p>An alternative variant of full share. While structures and engineers are transferred, all other mobile units are lost.</p>
          </div>

          <div class="card">
            <ul>
              <li>Add a game option to set the zoom threshold at which reclaim values are grouped together in the reclaim-overlay</li>
              <li>Allow mass storages to be built underwater</li>
              <li>Add a new key binding to select naval units, excluding sonar structures</li>
            </ul>
          </div>
        </div>

        <h2 id="ai">AI</h2>

        <div id="all-ai">

          <div>
            <p>This update adresses several long-standing issues that affected the custom AI that FAF introduces. Further developments and improvements of the AI will remain our focus in future updates.</p>

            <p>Additionally, we would like to remind people that there are various mods that provide different AI experiences. We can highly recommend you to download them from the vault and give them a spin too.</p>

            <b>A short list of AIs we recommend at this point:</b>

            <ul>
              <li>M27: made by Maudlin</li>
              <li>RNGAI, as made by Relent0r</li>
              <li>Sorian Edit, as made by Marlo</li>
              <li>Uveso AI, as made by Uveso</li>
              <li>Dilli Dally, as made by Softles</li>
              <li>Swarm AI, as made by Azraeel</li>
            </ul>

            <p>And not to forget the AI that ships with the Total Annihilation mod that is maintained by Dragun.</p>
          </div>

          <div class="card">
            <h3>Tunes the economic assesments of the AI.</h3>
            <p>Throughout the game the AI constantly tries to balance his decisions and those decisions depend on various conditions. These conditions can be tweaked and that is exactly what we did here.</p>
          </div>

          <div class="card">
            <h3> Separately keep track of radar structures for AIs</h3>
            <p>These are interesting and often vulnerable targets for the AI. By keeping track of them separately it can interact with them more easily. <br><br> Better guard those radars from now on!</p>
          </div>

          <div class="card">
            <h3>Add logic to prevent prematurely disbanding a platoon</h3>
            <p>A platoon is a group of units that is acting according to some logic that describes the behavior of the platoon. When a platoon disbands it returns to base to receive a new order. We fixed platoons disbanding too soon due to a bug.</p>
          </div>

          <div class="card">
            <h3>Improve consistency of builders used by the AI</h3>
            <p>A builder is not an engineer, but a set of conditions that the AI uses to determine what to build. These conditions depend on the status of the AI (do I need additional factories given my income?) and the status of the enemy (should I produce more interceptors?)</p>
          </div>

          <div class="card">
            <h3>Allow AIx multipliers that are lower than 1.0</h3>
            <p>Some people asked for this feature and here it is - for new players you can lower the multiplier to below 1.0</p>
          </div>

          <div class="card">
            <ul>
              <li>General tuning and bug fixing of the AIs. This involves all sorts of improvements, such as fixing a bug causing the AI to hoard units in their base and improving their use of naval units.</li>
              <li>AI has been upgraded to make better use of experimentals.</li>
            </ul>
          </div>
        </div>

        <h2 id="navigational-mesh">Navigational Mesh</h2>

        <div id="navmesh">

          <div>
            <p>The navigational mesh is an abstract representation of a map. The AI can use that representation to gain an understanding of what the map 'looks like'. The navigational mesh is generated at the start of the map and works on any map.</p>

            <p>We're looking for people with an interest in computer science to add features to add many other functions that allow the AI to understand. One example of such a feature is the ability to generate expansions markers: points of interest for the AI when it would like to build an expansion. And we'd like to add so much more so much more so that an AI can understand and properly play on any map. The navigational mesh is only use by the AI and only runs when there are AIs in-game.</p>
          </div>

          <div class="card">
            <h3>Add label utilities</h3>
            <p>Allows the AI to understand the value of an area, such as a plateau.</p>
          </div>

          <div class="card">
            <h3>Only load in the navigational mesh as requested</h3>
            <p>Entirely skip the generation of the navigational mesh when it is not used. This prevents allocation a few megabytes to store the navigational mesh in memory</p>
          </div>

          <div class="card">
            <h3>Improve retrieval of (nearest) leaf for path finding</h3>
            <p>This is an improvement to a macro feature (what is the general path from A to B?) and not a micro feature (how should I move this unit?). It is now more consistent, such that if a unit is remotely able to navigate to some place it will always have a label assigned to it.</p>
          </div>

          <div class="card">
            <h3>Add generation of expansion markers</h3>
            <p>These markers are generated for each map. The AI can now identify sane expansion locations on any map</p>
          </div>




        </div>

        <h2 id="bugs">Bug Fixes</h2>

        <div id="all-bugs">

          <div class="card">
            <h3>Fix removing restrictions breaking the HQ system</h3>
            <p>This was most notable during co-op</p>
          </div>
          <div class="card">
            <h3>Fix a bug with the creation of templates with 1x1 or 3x3 structures</h3>
            <p>The old method of creating templates would create gaps, the new implementation allows you to make proper templates with any structure size</p>
          </div>
          <div class="card">
            <h3>Fix a bug where pausing a unit would also stop updating the work progression</h3>
            <p>Often noticeable when assisting paused structures</p>
          </div>

          <div class="card">
            <ul>
              <li>General bug fixes that are too small to mention. These are usually introduced during the development environment and caught during testing.</li>
              <li>Fix Seraphim torpedo bomber being able to apply damage twice</li>
              <li>Fix the marker manager being unable to detect spawn markers</li>
              <li>Fix UI scaling of lobby messages</li>
              <li>Fix UI scaling of lobby map preview tooltips</li>
              <li>Fix and improve option keys</li>
              <li>Fix the charge icon of the loyalist</li>
              <li>Fix the Lighting Tank being unable to fire at targets on water</li>
              <li>Fix a bug where the construction menu would consistently reset</li>
              <li>Fix wrong LODs for Cybran shields</li>
              <li>Fix the charge animation of the Emissary</li>
              <li>Fix the direction of adjacency beams for factories</li>
              <li>Fix various units being refracted when rendered in front of water</li>
              <li>Fix a bug where neutral armies could view the entire map</li>
              <li>Fix the jumping and rotating of units as they start being built</li>
              <li>Fix offset of LOD1 of the CZAR</li>
              <li>Fix a bug where tech 2 and tech 3 Aeon engineers can not move backwards</li>
              <li>Fix a bug where damage indicators linger on and remain visible</li>
              <li>Fix a bug where using recall could make your ACU immune to damage</li>
            </ul>
          </div>

        </div>

        <h2 id="performance">Performance</h2>

        <div id="perf">

          <div>
            <p>We've been consistently improving the performance of the game by re-implementing features and in general by reducing the overhead of functionality. This section may not be as interesting for the average reader, but we add it anyway as good performance is an important aspect of the general user experience.</p>
          </div>

          <div class="card">
            <h3>Improve performance of the heap data structure by 60%</h3>
            <p>The heap data structure is used during path finding for AIs</p>
          </div>
          <div class="card">
            <h3>Reduce run-time parsing of categories for AIs</h3>
            <p>Replaces all string literals with their respective categories</p>
          </div>
          <div class="card">
            <h3>Reduce overhead of the objective arrow</h3>
            <p>Reduces memory usage of certain aspects of co-op missions</p>
          </div>
          <div class="card">
            <h3>Lower case all imports of build conditions</h3>
            <p>These are imported during run-time as they are processed, by having them as lower case characters we prevent a string operation to turn them into lower case characters during run time</p>
          </div>
          <div class="card">
            <h3>Remove fields on instance tables to reduce memory usage.</h3>
            <p>In Lua the hash part of tables grow by factors of two. It can be quite beneficial to refactor the code to remove a few fields as it can prevent the average unit to hit the threshold. As an example:
              <ul>
                <li>(1) A unit with 33 fields in its instance table will have space for up to 63 fields</li>
                <li>(2) A unit with 30 fields in its instance table will have space for up to 31 fields</li>
              </ul>
            </p>

            <p>Where the table occupies 64 * 20 = 1280 bytes in the first example and only 32 * 20 = 640 bytes in the second example.</p>
          </div>
          <div class="card">
            <h3>Separate AI and player logic</h3>
            <p>AI initialisation is now only performed when there is an AI in the game. For a game with no AIs these procedures are skipped which saves several dozens of megabytes worth of memory</p>
          </div>
          <div class="card">
            <h3>Reduce overhead of passing regeneration values to UI</h3>
            <p>These values are no longer passed via the sync, but attached to the state of the unit instead</p>
          </div>
          <div class="card">
            <h3>Reduce traffic between the sim and the UI layers</h3>
            <p>Every bit of data we send to the UI is (deep) copied and usually thrown away afterwards. This involves a lot of memory management and that is the most expensive type of logic that a computer can run these days.</p>
          </div>
          <div class="card">
            <h3>Reduce overhead of projectiles and weapons</h3>
            <p>The primary change is to reduce the amount of table trashing. An example is the use of a table within the scope of a function: it is allocated and then immediately ready to be de-allocated, which is a waste of performance and a hurdle for the garbage collector.</p>
          </div>
          <div class="card">
            <h3>Reduce overhead of class instantiation</h3>
            <p>Reduces the overhead of all instantiations such as the creation of effects, decals, projectiles, internal data structures and more. This is a significant boost to the performance overall</p>
          </div>
          <div class="card">
            <h3>Reduce memory footprint of navigational mesh by 50% to 95%</h3>
            <p>With thanks to <a href="https://github.com/FAForever/fa/pull/4523">#4523</a> we can now reliably measure the impact of changes, and as a result we managed to increase our awareness of what is expensive.</p>
          </div>
          <div class="card">
            <h3>Reduce overhead of unit treads</h3>
            <p>The new implementation is a lot more memory aware and reduces the amount of table trashing</p>
          </div>
          <div class="card">
            <h3>Reduce overhead of unit intel management</h3>
            <p>The new implementation is a lot more memory aware and drastically reduces the memory footprint of the average unit</p>
          </div>
          <div class="card">
            <h3>Dynamically compute LOD thresholds for units</h3>
            <p>The larger the unit the longer it remains in view. These values where all over the place. These changes create a consistent experience for players</p>
          </div>
          <div class="card">
            <h3>Reduce overhead of passing veterancy state to UI</h3>
            <p>The old implementation could cause stutters due to excessive copying of tables when syncing</p>
          </div>
          <div class="card">
            <h3>Fix memory leak with the veterancy system</h3>
            <p>The old implementation would keep a reference alive to essentially every unit in the game that ever received or did damage to another unit. This would create a directional graph of references with the ACUs being the spills. As a result there is a significant build up of memory as the game progresses</p>
          </div>
          <div class="card">
            <h3>The game can now use up to 4 gigabytes of memory, instead of just 3 gigabytes</h3>
            <p>Due to an assembly patch the game can now use an additional gigabyte of memory. In combination with all the other memory improvements mentioned this should prevent all cases of where players run out of memory</p>
          </div>
          <div class="card">
            <ul>
              <li>Reduce overhead of builder conditions of AI</li>
              <li>Replace legacy trashbags with the TrashBag class</li>
            </ul>
          </div>

        </div>

        <h2 id="pbr">Physics Based Rendering (PBR)</h2>
        <div id="all-pbr">

          <div>
            <p>We're slowly but surely preparing the game for a significant visual improvement. This is a long term project that is going to consume hundreds of hours. We're hoping to find additional contributors that have an interesting in creating (and fixing) meshes and textures.</p>

            <p>If you have that interest and/or experience and you'd like to help out then you can introduce yourself in the dedicated channels in the official Discord channel!</p>
          </div>

          <div class="card">
            <h3>Introduces shaders for Physics Based Rendering (PBR)</h3>
            <p>The shaders are not used yet but the code is ready to run</p>
          </div>
          <div class="card">
            <h3>Fix existing cube maps and prepare them for PBR</h3>
            <p>Adds a blur to the mip maps to mimic roughness of the surface</p>
          </div>
          <div class="card">
            <ul>
              <li>Re-create the Cybran land factories</li>
              <li>Re-create the Cybran naval factories</li>
              <li>Re-create the Cybran air factories</li>
              <li>Re-create the Aeon air factories</li>
              <li>Re-create the Aeon land factories</li>
              <li>Re-create the Aeon naval factories</li>
              <li>Fix localisation and colors of default fields of combo</li>
            </ul>
          </div>




        </div>

        <h2 id="other">Other</h2>
        <div id="all-other">

          <div class="card">
            <h3>All the annotation work that has been merged in.</h3>
            <p>We have an extension that allows you (a developer) to gain basic intellisense support in the repository. This has been, and still is a massive improvement to the workflow of those that work on the game (in)directly.
            </p>
          </div>
          <div class="card">
            <h3>Fix terrain-type depending mesh selection of structures</h3>
            <p>This feature is not used, but technically it allows you to change the (textures) of a structure depending on the terrain type it resides on. As an example: a factory on snow would have snow on it</p>
          </div>
          <div class="card">
            <h3>Introduce function to determine size of table in memory</h3>
            <p>Introduce function to determine size of table in memory</p>
          </div>
          <div class="card">
            <h3>Fix firing sequence of the UEF Cruiser</h3>
            <p>This is a visual fix and does not impact gameplay.</p>
          </div>
          <div class="card">
            <ul>
              <li>Add or improve Chinese translation</li>
              <li>Improve the test functionality of movies</li>
              <li>Reduce code duplication by introducing 'table.random'</li>
              <li>Add division icons</li>
              <li>Add MIT licenses to various FAF-introduced files</li>
              <li>Add a russian translation for the balance patch</li>
              <li>Add a code of conduct to the repository</li>
              <li>Fix the auto balance button in the lobby being too large</li>
              <li>Remove logging of console commands</li>
            </ul>
          </div>




        </div>

        <h2 id="mods">Mod Incompatibility</h2>

        <div>
          <p>There appears to be an issue with the UI mod 'Supreme Economy v2.3'. We've notified the maintainer.</p>
        </div>


        <h2>Contributors</h2>

        <div class="card">
          <ul>
            <li>Rowey</li>
            <li>4z0t</li>
            <li>Relent0r</li>
            <li>BlackYps</li>
            <li>Blodir</li>
            <li>Zjonn</li>
            <li>MadMax</li>
            <li>Jip</li>
            <li>xXEddieXxx</li>
            <li>speed2</li>
            <li>hdt80bro</li>
            <li>Yuchenjimmy</li>
            <li>Penguin</li>
            <li>Haifron</li>
            <li>Balthazar</li>
            <li>Senex-x</li>
            <li>MostLostNoob</li>
            <li>maudlin27</li>
            <li>KionX</li>
            <li>BlueAmulet</li>
          </ul>
        </div>

        <div>
          <p>At last I'd like to thank Phong for consistently hosting games on the FAF Develop game type. I've watched almost all his games to track down bugs that would otherwise go unnoticed. And my thanks to Prohibitorum for proof reading the changelogs.</p>
        </div>

        <hr>

        <div class="backtotop">
          <button>
            <a class="toptext" href="#top">Back to Top</a>
          </button>
        </div>

      </div>
      <div class="sidebar">
        <div>
          <h2><u>Contents</u></h2>
          
          <h3>&gt; <a href="#features">Features</a></h3>
          <h3>&gt; <a href="#ai">AI</a></h3>
          <h3>&gt; <a href="#navigational-mesh">Navigational mesh</a></h3>
          <h3>&gt; <a href="#performance">Performance</a></h3>
          <h3>&gt; <a href="#pbr">Physics Based Rendering (PBR)</a></h3>
          <h3>&gt; <a href="#other">Other</a></h3>
          <h3>&gt; <a href="#mods">Mod incompatibility</a></h3>
        </div>
      </div>
    </main>
  </body>
  <footer>
    <a href="./index.html">Back to Patchnote List</a>
    <p>© 2014-2024 FAForever</p>
  </footer>
</html>